---
title: "Final Report: Election Prediction"
author: "Alexander Bendeck, Lynn Fan, Cathy Lee, Alice Liao, Justina Zou"
date: "28 October 2020"
fontsize: 11pt
geometry: "left=1.5cm,right=1.5cm,top=1.5cm,bottom=1.5cm"
output: 
  pdf_document: 
  latex_engine: xelatex
  fig_width: 2
  fig_height: 1
header-includes:
- \usepackage{booktabs}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r pkgtest, echo=FALSE}
# source: https://stackoverflow.com/questions/9341635/check-for-installed-packages-before-running-install-packages
pkgTest <- function(x)
  {
    if (!require(x,character.only = TRUE))
    {
      install.packages(x,repos = "http://cran.r-project.org",dep=TRUE)
        if(!require(x,character.only = TRUE)) stop("Package not found")
    }
  }
```

```{r check package,include=FALSE}
pkgTest("gtable") 
pkgTest("ggplot2") 
pkgTest("gridExtra") 
pkgTest("xtable") 
pkgTest("coda") 
pkgTest("dplyr")
pkgTest("reshape2")
pkgTest("readr")
pkgTest("grid")
pkgTest("bayesplot")
pkgTest("knitr")
pkgTest("tidyverse")
pkgTest("stringr")
pkgTest("stringi")
pkgTest("ggplotify")
pkgTest("tidybayes") # easy residuals
```

```{r packages, include=FALSE, message = F}
library(gtable)
library(ggplot2)
library(gridExtra)
library(rjags)
library(R2jags)
library(grid)
library(xtable)
library(coda)
library(bayesplot)
library(rstanarm)
library(dplyr)
library(reshape2)
library(knitr)
library(tidyverse)
library(stringr)
library(stringi)
library(ggplotify)
library(brms)
library(tidybayes) # easy residuals
library(usmap)
#library(xtable)
```

## Introduction

The United States is getting closer to the 2020 presidential and Congressional elections on November 3, 2020. All 435 seats in the United States House of Representatives, 35 of the 100 seats in the United States Senate, and the office of President of the United States are up for election (Wikipedia, 2020). With the current polarizing political landscape, the election outcomes are significant to determine the next stage of this country. Polarization also makes election prediction both less and more difficult. It is less difficult because election results are less subject to election or candidate-specific factors, and it is more difficult as elections become increasingly close and fierce competitions, especially for presidential elections (Gelman, 2020). Therefore, we believe 2020 is a particularly challenging yet interesting year for statisticians to predict election outcomes and compare results with other predictions and the actual outcome to reflect on methodologies and unaccounted predictors. These election predictions not only inform the public about campaign trends and political sentiments but also help political strategists make decisions on allocating campaign resources for different candidates (Linzer et al.). American political pundits have been spending countless hours obtaining and analyzing relevant data to predict the election outcomes, and historical models and predictions and pre-election polls are two of the most important sources of information (Linzer et al.). In this report, similarly, we will also be using both literature review and polls for 2020 to build our prediction models.
\newline
We plan to build prediction models for the 2020 U.S. presidential election and the Senate election nationwide. Also, among all states, we decide to further predict the U.S. House election outcome for North Carolina, as it has been a swing state in presidential and Congressional elections for decades. Since 1996, the Republican statewide vote share in Congressional elections has varied "from a low of 45% in 2008 to a high of 55% in 2014" (Perrin et al.). To summarize, this report aims to use statistical models to predict (1) the outcome of the presidential election, (2) whether the US Senate remains in Republican control, (3) the electoral college vote, (4) the outcomes of all NC Congressional elections (the 13 federal Representatives to Congress), and (5) the outcome of the NC Senate election, including characterization of uncertainty in predictions.

## Data Description

Senate poll/House poll: from https://data.fivethirtyeight.com/
States_cov_matrix: from the Economist paper
Economist prediction polls: from the Economist paper (pres)
partisan lean (prior for pres): from 538
Abramowitz data: from the Economist paper (pres)


## Exploratory Data Analysis

```{r load data, include = F}
pres_eda_df = readRDS("cleaned_pres_polls.rds")
econ_eda_df = readRDS("cleaned_econ_polls.rds")
econ_state_df = econ_eda_df %>%
  group_by(state) %>%
  summarise(n=n(),avg=mean(y))
house_eda_df = readRDS("cleaned_house_polls.rds")
senate_eda_df = readRDS("cleaned_senate_polls.rds")
senate_state_df = senate_eda_df %>%
  group_by(state) %>%
  summarise(n=n(),avg=mean(y))
```

```{r president EDA, echo=F, fig.width=8,fig.height=4, fig.align='center', fig.cap="Presidential Election Data Visualization"}
#democrat percentage by states
p1 <- plot_usmap(data = econ_state_df, values = "avg", color = "black") + 
  scale_fill_continuous(low = "red", high = "blue",name = "Average Democrat Vote Share", label = scales::comma) + 
  theme(legend.position = "right") + labs(title = "Map For Democrat Vote Share Among States of Interest")
#democrat percentage in polling data
p2 <- ggplot(econ_eda_df, aes(days_to_election, y)) + geom_point() + labs(y="Percentage", x = "Days to Election", title = "Does Democrat Vote Share Varies \n With Days To Election In Polls?") +theme(plot.title = element_text(hjust = 0.5,size = 8),axis.title=element_text(size=8),legend.key.size = unit(0.5,"line")) + scale_x_reverse()

grid.arrange(grobs = list(p1,p2), ncol = 2)
```

```{r senate EDA, echo=F, fig.width=8,fig.height=4, fig.align='center', fig.cap="U.S. Senate Election Data Visualization"}
#democrat percentage by states
s1 <- plot_usmap(data = senate_state_df, values = "avg", color = "black") + 
  scale_fill_continuous(low = "red", high = "blue",name = "Average Democrat Vote Share", label = scales::comma) + 
  theme(legend.position = "right") + labs(title = "Map For Democrat Vote Share Among States of Interest")
#biden percentage in polling data
s2 <- ggplot(senate_eda_df, aes(days_to_election, y)) + geom_point() + labs(y="Percentage", x = "Days to Election", title = "Does Democrat Vote Share Varies \n With Days To Election In Polls?") +theme(plot.title = element_text(hjust = 0.5,size = 8),axis.title=element_text(size=8),legend.key.size = unit(0.5,"line")) + scale_x_reverse()

grid.arrange(grobs = list(s1,s2), ncol = 2)
```


## Method

## Results

## Model Validation and Sensitivity Checks

## Diagnostics

# Appendix

## References
1. Linzer, D. A. (2013). Dynamic Bayesian Forecasting of Presidential Elections in the States. Journal of the American Statistical Association, 108(501), 124-134. doi:10.1080/01621459.2012.737735
\newline
2. Hansford, T. G., &amp; Gomez, B. T. (2010). Estimating the Electoral Effects of Voter Turnout. American Political Science Review, 104(2), 268-288. doi:10.1017/s0003055410000109
\newline
3. 2020 Election. (2020, October 20). Retrieved October 20, 2020, from https://fivethirtyeight.com/politics/elections/
\newline
4. Park, D. K., Gelman, A., &amp; Bafumi, J. (2006). State-Level Opinions from National Surveys:. Public Opinion in State Politics, 209-228. doi:10.2307/j.ctvr33bdg.17
\newline
5. Mahler, V. A., Jesuit, D. K., &amp; Paradowski, P. R. (2013). Electoral Turnout and State Redistribution. Political Research Quarterly, 67(2), 361-373. doi:10.1177/1065912913509306
\newline
6. Uhlaner, C. J., &amp; Scola, B. (2015). Collective Representation as a Mobilizer. State Politics &amp; Policy Quarterly, 16(2), 227-263. doi:10.1177/1532440015603576
\newline
7. Godbout, J. (2012). Turnout and presidential coattails in congressional elections. Public Choice, 157(1-2), 333-356. doi:10.1007/s11127-012-9947-7
\newline
8. Kim, S. S., Alvarez, R. M., &amp; Ramirez, C. M. (2020). Who Voted in 2016? Using Fuzzy Forests to Understand Voter Turnout. doi:10.33774/apsa-2020-xzx29
\newline
9. Weinschenk, A. C. (2019) That’s Why the Lady Lost to the Trump: Demographics and the 2016 Presidential Election, Journal of Political Marketing, 18:1-2, 69-91, DOI: 10.1080/15377857.2018.1478657
\newline
10. Charles, K. K., &amp; Stephens, M. (2011). Employment, Wages and Voter Turnout. doi:10.3386/w17270
\newline
11. Hills, M. (2020, September 25). US election 2020: A really simple guide. Retrieved October 20, 2020, from https://www.bbc.com/news/election-us-2020-53785985
\newline
12. Railey, K. (2016). Federal Judges Let Stand North Carolina,'s New Congressional Map. The Hotline. https://link.gale.com/apps/doc/A498010836/ITOF?u=duke_perkins&sid=ITOF&xid=119d6ad9
\newline
13. Perrin, A. J., &amp; Ifatunji, M. A. (2020). Race, Immigration, and Support for Donald Trump: Evidence From the 2018 North Carolina Election. Sociological Forum, 35(S1), 941-953. doi:10.1111/socf.12600
\newline
14. Redistricting in North Carolina. (2020). Retrieved October 21, 2020, from https://ballotpedia.org/Redistricting_in_North_Carolina
\newline
15. Â§ 132-1. Public Records.
https://www.ncleg.gov/EnactedLegislation/Statutes/PDF/BySection/Chapter_132/GS_132-1.pdf
\newline
16. Â§ 163-82.10.  Official record of voter registration.
https://www.ncleg.gov/EnactedLegislation/Statutes/PDF/BySection/Chapter_163/GS_163-82.10.pdf
\newline
17. FairVote.org. (n.d.). Voter Turnout. Retrieved October 22, 2020, from https://www.fairvote.org/voter_turnout
\newline
18. McDonald, M. P. (2020). Voter Turnout Demographics. Retrieved October 23, 2020, from http://www.electproject.org/home/voter-turnout/demographics
\newline
19. Y. Ghitza, A. Gelman’s (2013). Deep interactions with MRP: Election Turnout and Voting Patterns Among Small Electoral Subgroups. American Journal of Political Science 57 762– 776.
\newline
20. Walker, H.L., Herron, M.C. & Smith, D.A. Early Voting Changes and Voter Turnout: North Carolina in the 2016 General Election. Polit Behav 41, 841–869 (2019). https://doi-org.proxy.lib.duke.edu/10.1007/s11109-018-9473-5 
\newline
21. Pew Research Center (2020). Men and women in the U.S. continue to differ in voter turnout rate, party identification. https://www.pewresearch.org/fact-tank/2020/08/18/men-and-women-in-the-u-s-continue-to-differ-in-voter-turnout-rate-party-identification/ 
\newline
22. Pew Research Center (2016). Party affiliation among voters: 1992-2016.
https://www.pewresearch.org/politics/2016/09/13/2-party-affiliation-among-voters-1992-2016/ 
\newline
23. J. Misra (2019). Voter Turnout Rates Among All Voting Age and Major Racial and Ethnic Groups Were Higher Than in 2014. https://www.pewresearch.org/fact-tank/2020/08/18/men-and-women-in-the-u-s-continue-to-differ-in-voter-turnout-rate-party-identification/
\newline
24. Killian, L. (2012). Five Myths About Independent Voters. Retrieved October 22, 2020, from https://www.washingtonpost.com/opinions/five-myths-about-independent-voters/2012/05/17/gIQAZmGyWU_story.html
\newline
25. Igielnik, R. (2020). Men and Women in the U.S. Continue to Differ in Voter Turnout Rate. Retrieved October 22, 2020, from https://www.pewresearch.org/fact-tank/2020/08/18/men-and-women-in-the-u-s-continue-to-differ-in-voter-turnout-rate-party-identification/
\newline
26. Akee, R. (2019). Voting and Income. Retrieved October 22, 2020, from https://econofact.org/voting-and-income
\newline
27. Wikipedia. 2020 United States elections. (2020, October 27). Retrieved October 31, 2020, from https://en.wikipedia.org/wiki/2020_United_States_elections
\newline
28. Gelman, A., &amp; Heidemanns, M. (2020). President-Forecasting the US 2020 elections. Retrieved November 01, 2020, from https://projects.economist.com/us-2020-forecast/president
\newline
29. Gelman, A., Hullman, J., Wlezien, C., & George, E. M. (2020). Information, incentives, and goals in election forecasts. Judgment and Decision Making, 15(5), 863-880. 

## Additional EDA
```{r Additional EDA, echo=F, fig.width=8,fig.height=4, fig.align='center', fig.cap="Additional Presidential Election Data Visualization"}
#number of polls for each state in the economist paper data set
plot_usmap(data = econ_state_df, values = "n", color = "red") + 
  scale_fill_continuous(name = "Number of Polls", label = scales::comma) + 
  theme(legend.position = "right") + labs(title = "Map For The Number of Filtered Polls Among States")
```

```{r Additional EDA Senate, echo=F, fig.width=8,fig.height=4, fig.align='center', fig.cap="Additional Senate Election Data Visualization"}
#number of polls for senate
plot_usmap(data = senate_state_df, values = "n", color = "red") + 
  scale_fill_continuous(name = "Number of Polls", label = scales::comma) + 
  theme(legend.position = "right") + labs(title = "Map For The Number of Filtered Polls Among States")
```