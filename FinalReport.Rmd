---
title: "Final Report: Election Prediction"
author: "Alexander Bendeck, Lynn Fan, Cathy Lee, Alice Liao, Justina Zou"
date: "2 November 2020"
fontsize: 11pt
geometry: "left=1.5cm,right=1.5cm,top=1.5cm,bottom=1.5cm"
output: 
  pdf_document: 
  latex_engine: xelatex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r pkgtest, echo=FALSE}
# source: https://stackoverflow.com/questions/9341635/check-for-installed-packages-before-running-install-packages
pkgTest <- function(x)
  {
    if (!require(x,character.only = TRUE))
    {
      install.packages(x,repos = "http://cran.r-project.org",dep=TRUE)
        if(!require(x,character.only = TRUE)) stop("Package not found")
    }
  }
```

```{r check package,include=FALSE}
pkgTest("gtable") 
pkgTest("ggplot2") 
pkgTest("gridExtra") 
pkgTest("xtable") 
pkgTest("coda") 
pkgTest("dplyr")
pkgTest("reshape2")
pkgTest("readr")
pkgTest("grid")
pkgTest("bayesplot")
pkgTest("knitr")
pkgTest("tidyverse")
pkgTest("stringr")
pkgTest("stringi")
pkgTest("ggplotify")
pkgTest("tidybayes") # easy residuals
pkgTest("rgdal")
```

```{r packages, include=FALSE, message = F}
library(gtable)
library(ggplot2)
library(gridExtra)
library(rjags)
library(R2jags)
library(grid)
library(xtable)
library(coda)
library(bayesplot)
library(rstanarm)
library(dplyr)
library(reshape2)
library(knitr)
library(tidyverse)
library(stringr)
library(stringi)
library(ggplotify)
library(brms)
library(tidybayes) # easy residuals
library(usmap)
library(directlabels)
#library(xtable)
```

## Introduction

The United States is getting closer to the 2020 presidential and Congressional elections on November 3, 2020. All 435 seats in the United States House of Representatives, 35 of the 100 seats in the United States Senate, and the office of President of the United States are up for election (Wikipedia, 2020). With the current polarizing political landscape, the election outcomes are significant to determine the next stage of this country. Polarization also makes election prediction both less and more difficult. It is less difficult because election results are less subject to election or candidate-specific factors, and it is more difficult as elections become increasingly close and fierce competitions, especially for presidential elections (Gelman, 2020). Therefore, we believe 2020 is a particularly challenging yet interesting year for statisticians to predict election outcomes and compare results with other predictions and the actual outcome to reflect on methodologies and unaccounted predictors. These election predictions not only inform the public about campaign trends and political sentiments but also help political strategists make decisions on allocating campaign resources for different candidates (Linzer et al.). American political pundits have been spending countless hours obtaining and analyzing relevant data to predict the election outcomes, and historical models and predictions and pre-election polls are two of the most important sources of information (Linzer et al.). In this report, similarly, we will also be using both literature review and polls for 2020 to build our prediction models.
\newline
We plan to build prediction models for the 2020 U.S. presidential election and the Senate election nationwide. Also, among all states, we decide to further predict the U.S. House election outcome for North Carolina, as it has been a swing state in presidential and Congressional elections for decades. Since 1996, the Republican statewide vote share in Congressional elections has varied "from a low of 45% in 2008 to a high of 55% in 2014" (Perrin et al.). To summarize, this report aims to use statistical models to predict (1) the outcome of the presidential election, (2) whether the US Senate remains in Republican control, (3) the electoral college vote, (4) the outcomes of all NC Congressional elections (the 13 federal Representatives to Congress), and (5) the outcome of the NC Senate election, including characterization of uncertainty in predictions.

## Data Description

In literature, election prediction relies on polling data as well as the fundamentals, which are economic indicators (The Economist, 2020) and voter turnout by demographic groups (Hansford, et al.). To forecast the outcomes of presidential election, Senate election and House election (for North Carolina only), we obtained 2020 presidential polling data from *The Economist*, 2020 senate and house polling data as well as partisan lean data from *FiveThirtyEight*. Partisan lean data refers to the average difference between how a state or district votes and how the country votes overall, based on results from the past two presidential elections as well as statewide elections in 2018. 

The fundamentals data were retrieved from various online sources, including Andrew Gelman's presidential election prediction Github repository (for correlation across states and historical incumbent party's June approval ratings), Federal Reserve Economic Data (for second quarter real income growth), and the NC Board of Elections website (for 2020 NC registered voter demographics). Please refer to Appendix B for a detailed description of all data sets used. 

## Data Processing and Missing Data

For both the president and Senate election models, we had to choose which states we considered to be "battlegrounds" to include in the models. We chose states for the models separately, since some states have a competitive race for presidential election but not for Senate, and vice versa. 
\newline
For the presidential election data, we choose to use polling data within 30 days before the election, as this aligns with Andrew Gelman's observation that polling data becomes more predictive as the day of poll becomes closer to election day (Gelman, 2020). Note that state-wide polls 30 days or less are unavailable for 15 states, including Oregon and Idaho. But these states are not swing states in recent elections, so we did not include those in our modeling process. For modeling, we will filter out those states with obvious party preferences and focus on those states showing percentages swinging right above or below 50%. For the presidential model, the states chosen are Arizona, Florida, Georgia, Iowa, Michigan, Minnesota, Nevada, New Hampshire, North Carolina, Ohio, Pennsylvania, Texas, and Wisconsin. These thirteen states are rated as either "Toss Up", "Lean Republican", or "Lean Democrat" races (the three most competitive categories) by the Cook Political Report, an nonpartisan elections newsletter, as of October 28 (Cook Political Report, 2020). These states are also projected to be competitive in the presidential race by both the FiveThirtyEight and Economist models. We select poll responses from likely voters only, since it is known that using all responses may overestimate support for the Democratic party, according to FiveThirtyEight (Silver, 2014). 
\newline
For the Senate model, the states chosen are Alaska, Arizona, Colorado, Georgia, Iowa, Kansas, Maine, Michigan, Montana, North Carolina, South Carolina, and Texas. Note that state-wide polls 30 days or less are unavailable for 28 states. One example is Oregon, but this state has strong historical party preferences, and the missing data does not hurt our modeling process as we are only focusing on the swing states. There is also a special election for the Senate in Georgia in addition to the regularly scheduled election. These thirteen races are also rated as either "Toss Up", "Lean Republican", or "Lean Democrat" (the three most competitive categories) by the Cook Political Report as of October 29 (Cook Political Report, 2020). and are projected to have competitive Senate races by both the FiveThirtyEight and Economist models.
\newline
For the U.S. House election, due to the scarcity of poll responses for the NC House elections, we included all poll responses within 115 days of the election. We will supplement the polls with the voter turnout results from our interim report to predict the House election for NC.

## Exploratory Data Analysis

```{r load data, include = F}
pres_eda_df = readRDS("cleaned_pres_polls.rds")
econ_eda_df = readRDS("cleaned_econ_polls.rds")
econ_state_df = econ_eda_df %>%
  group_by(state) %>%
  summarise(n=n(),avg=mean(y))
house_eda_df = readRDS("cleaned_house_polls.rds")
senate_eda_df = readRDS("cleaned_senate_polls.rds")
senate_state_df = senate_eda_df %>%
  group_by(state) %>%
  summarise(n=n(),avg=mean(y))
```

```{r president EDA, echo=F, fig.width=8,fig.height=4, fig.align='center', fig.cap="Presidential Election Data Visualization"}
#democrat percentage by states
p1 <- plot_usmap(data = econ_state_df, values = "avg", color = "black") + 
scale_fill_gradient2(low = "red", mid = "white", high = "blue", midpoint = 50,
                       aesthetics = "fill", name = "Average Democrat Vote Share", label = scales::comma) + 
  theme(legend.position = "right") + labs(title = "Map For Biden's Vote Share Among States of Interest")
#democrat percentage in polling data
manualcolors<-c('black','forestgreen', 'red2', 'orange', 'cornflowerblue', 
                'magenta', 'tan4', 'darkblue', 
                'mediumorchid1','firebrick4',  'yellowgreen', 'lightsalmon','darkgray')
p2 <- ggplot(econ_eda_df, aes(days_to_election, y, color=state)) + geom_point() + labs(y="Percentage", x = "Days to Election", title = "Does Biden's Vote Share Varies \n With Days To Election In Polls?") +theme(plot.title = element_text(hjust = 0.5,size = 8),axis.title=element_text(size=8),legend.key.size = unit(0.5,"line")) + scale_x_reverse() + scale_color_manual(values=manualcolors)

grid.arrange(grobs = list(p1,p2), ncol = 2)
```
After initial data cleanup for analysis, Figure 1 aims to explore the polling data we have for the 2020 presidential election within 30 days of election, after filtering for the states of interest. The left plot shows that most states, as the polls indicate, have a vote share higher than 50% for Biden, averaging on all the polls available for each state respectively. Ohio is the only state here with a light red color. The right plot shows that within 30 days to election, variations exist for Biden support rate among polls within individual states. Combined with abundant literature that takes time into account for outcome prediction models, we will take days to election as a part of our model prediction as well (Gelman, 2020).

```{r senate EDA, echo=F, fig.height = 4, fig.width = 8, fig.align='center', fig.cap="U.S. Senate Election Data Visualization"}
manualcolors<-c('black','forestgreen', 'red2', 'orange', 'cornflowerblue', 
                'magenta', 'tan4', 'darkblue', 
                'mediumorchid1','firebrick4',  'yellowgreen', 'lightsalmon','darkgray')
#democrat percentage by states
s1 <- plot_usmap(data = senate_state_df, values = "avg", color = "black") + 
scale_fill_gradient2(low = "red", mid = "white", high = "blue", midpoint = 50,
                       aesthetics = "fill", name = "Average Democrat Vote Share", label = scales::comma) + 
  theme(legend.position = "right") + labs(title = "Map For Democrat Vote Share Among States of Interest")
s2 <- ggplot(senate_eda_df, aes(days_to_election, y,color=state)) + geom_point() + labs(y="Percentage", x = "Days to Election", title = "Does Democrat Vote Share Varies \n With Days To Election In Polls?") + theme(plot.title = element_text(hjust = 0.5,size = 8),axis.title=element_text(size=8),legend.key.size = unit(0.5,"line")) + scale_x_reverse() + scale_color_manual(values=manualcolors)

grid.arrange(grobs = list(s1,s2), ncol = 2)
```

Similarly, Figure 2 visualizes the polling data we have for the 2020 U.S. Senate election, also within 30 days of election and after filtering for the states of interest. The left plot shows that most states, as the polls indicate, have a vote share higher than 50% for the Democratic Party, averaging on all the polls available for each state respectively. Texas is the only state with a bright red color in this data set. The right plot shows that within 30 days to election, variations exist for the Democratic party vote share among polls within individual states, such as the trend seen for North Carolina as Democratic Party vote share decreases getting closer to the election. We will take days to election as a part of our model prediction as well.

```{r house EDA load data, include=F}
load("vote_share_df.Rdata")
vote_share_df$Dem_vote_share <- round(vote_share_df$Dem_vote_share,2)
```

```{r president EDA-2, echo=F, fig.width=8,fig.height=4, fig.align='center', fig.cap="Democratic Vote Share Predicted By The Interim Report", message = F, warning = F}
#vote share by cong district
ggplot(data=vote_share_df, aes(x=cong_dist, y=Dem_vote_share)) +
  geom_bar(stat="identity", fill="steelblue")+
  geom_text(aes(label=Dem_vote_share), vjust=-0.3, size=3.5)+
  labs(x = "Congressional District", y = "Democratic Vote Share") +
  theme_minimal()
```
Figure 3 shows the different Democratic Party vote shares predicted by our interim report for all congressional districts in North Carolina. After predicting for voter turnout in the interim report, we use the party registration for predicted voters to get the vote share for the Democratic Party. First, we grouped predicted voters for congressional districts. There are three categories in party registration: Democratic, Republican, and other (indicating a third party or unaffiliated). Within each congressional district, we split the `other` population in half, and add it to both the Democratic Party vote count and the Republican Party vote count, as FiveThirtyEight used the same approach to get vote share for their House predictions, shown in[https://projects.fivethirtyeight.com/2020-election-forecast/house/]. Among 13 districts, 6 of them have a Democratic Party vote share higher than 50%. 

## Method

Similar to prior work (Linzer 2013), we use a hierarchical model structure for our election models to overcome the limitation that not every state is polled on every day, allowing the model to borrow data across states (or congressional districts). This also helps account for the fact that polls from each individual state are correlated data observations (Gelman, 2020). We believe that vote share should be modeled as a normal distribution because, historically, vote shares among candidates have mode toward the center of the distribution (landslides are unlikely, especially in the case of a presidential election). In addition, we chose for our random walk to be lag-1 because it’s more reasonable to have updated predictions dependent on the previous prediction as opposed to a longer time period (see model specification below).

To specify priors for the mean two-party vote share for the Democratic Party in each state or district, we used a combination of state partisanship, economic fundamentals, candidate incumbency, and projected voter turnout based on demographics. First, we started with state or district partisan lean calculated by FiveThirtyEight (see "FiveThirtyEight's Partisan Lean" in references). Partisan lean is the average difference between how a state or district votes and how the country votes overall, based on results from the past two presidential elections as well as statewide elections in 2018. For example, North Carolina has a partisan lean of R+4, meaning that in a 50/50 political environment nationwide, a Republican would be expected to win North Carolina by 4 points. For each partisan lean, we turn it into a part of our prior mean of Democratic vote share by adding or subtracting half the partisan lean from 50%. North Carolina is a Republican-leaning state, so we subtract 2 from 50% to get a partisan lean prior of 48% (note that the Republican would then get 52% of the two-party vote, resulting in an R+4 margin of victory).

### Presidential Election Model

For the presidential model, as discussed previously, the states chosen are Arizona, Florida, Georgia, Iowa, Michigan, Minnesota, Nevada, New Hampshire, North Carolina, Ohio, Pennsylvania, Texas, and Wisconsin. 

The response we will use is $Y_k$, Biden's two-party vote share using the following model where the poll $k$ (of $K$=*3361* polls) ended $t$ days (of $T=30$ days) before the election and was conducted on state $j$ (of $J$=13 states of interest). 

<!-- We choose to use polling data from 30 days before the election (as opposed to over 30 days), as this aligns with Andrew Gelman's observation that polling data becomes more predictive as the day of poll becomes closer to election day (The Economist). -->

$Y_k \sim N(\theta_{jt},\sigma^2_{yj})$ \newline
$\theta_{\cdots t} \sim MVN(\theta_{\cdots t-1},\Sigma)$ \newline
$\Sigma \sim Wishart(S, J+1)$ where $S$ is the state covariance matrix (obtained from Andrew Gelman's model) and $J$ is the number of states in the model. \newline
Priors for $\sigma^2_{yj}$: \\
$\sigma^2_{yj} \sim InvGamma(\nu_u, \nu_y\tau_y)$ \newline
$\nu_y \sim Uniform(0,100)$ and $\tau_y \sim Uniform(0,100)$. \newline
Priors for $\theta_{j1}$: \\
$\theta_{j1} \sim N(\mu_{j}, \sigma^2)$  \newline
$\sigma^2 \sim InvGamma(0.5, 0.5)$ \newline
$\mu_{j} \sim N(h_j,7.5^2)$  \newline
$h_j = 0.1*\hat{\text{Presidential Fundamentals}_{2020}} + 0.9*\text{Vote Share from Partisan Lean}_j$  \newline
$\text{Presidential Fundamentals}_i = 100 - \text{Incumbent Party Vote Share}_i$ \newline
$\text{Incumbent Party Vote Share}_i= \gamma_0 + \gamma_1\text{June Approval Rating for Incumbent Party}_i + \gamma_2\text{Three Month Stock Growth}_i + \gamma_3\text{2nd Quarter Real Income Growth}_i +\epsilon_i$  \newline
$\epsilon_i \sim N(0, \phi^2)$  \newline

For our presidential model, we wanted to incorporate state-level correlations that differ between each pair of states. For example, Wisconsin is much more similar to its Great Lakes neighbor Michigan both geographically and demographically than it is to Arizona, which is in the Southwest and has a much larger Hispanic population. So, we would expect that Wisconsin and Michigan have a higher correlation in their election results than Wisconsin and Arizona. In order to incorporate this into our presidential model, we used a multivariate normal distribution to model two-party vote share in each state, which allowed us to specify a covariance matrix for the states. We used a covariance matrix which was downloaded from *The Economist* forecast model (Gelman, 2020). These similarities between states were calculated by comparing their demographic and political profiles, such as the state's share of white voters and how urban/rural the state is.

In essence, the presidential model used fundamentals and vote share from partisan lean as a starting point for the expected vote share for the Democratic party, and updated the priors with presidential election polling data. We first predicted incumbent party's national vote share ($\text{Incumbent Party Vote Share}_i$) based on the corresponding election year $i$'s economic data and June net approval rating of the incumbent party. Since in the 2020 presidential election Biden's Democratic Party is not the incumbent party, $\text{Presidental Fundamentals}_{2020}$, the national level prior of Biden's vote share, is 100 minus $\text{Incumbent Party Vote Share}_{2020}$. When computing the state specific prior, 10% weight is allocated to the fundamentals based on economic data and 90% weight to the state's partisan lean because the effect of economic indicators has shrunk over the years as electorates became increasingly polarized (The Economist, 2020). In addition, economic indicators are particularly volatile in 2020 due to the COVID-19 pandemic (Gillespie et al. 2020). For the hyperparameters, we chose high variance to reflect the uncertain nature in the political arena in recent years.

Presidential elections in the United States are decided by the Electoral College, so estimating percentage support in each state alone does not tell us who wins the election. For each set of MCMC samples of two-party vote share by state, we subsequently use the predicted winner in each state to add up the electoral votes of each candidate. For states not in the model, their electoral votes are allocated assuming they vote the same way as in 2016. The probability of President Trump winning re-election is then the probability that he receives 270 or more electoral votes across simulations. Note that although Maine and Nebraska allocate some electoral votes by Congressional District, only two electoral votes are competitive due to this wrinkle, so for simplicity we simply allocate all electoral votes to the statewide winner of each respective state.

### Senate Election Model

For the Senate model, the states chosen are Alaska, Arizona, Colorado, Georgia, Iowa, Kansas, Maine, Michigan, Montana, North Carolina, South Carolina, and Texas. 

<!-- There is also a special election for the Senate in Georgia in addition to the regularly scheduled election. These thirteen races are rated as either "Toss Up", "Lean Republican", or "Lean Democrat" (the three most competitive categories) by the Cook Political Report (as of October 29). These states are also projected to have competitive Senate races by both the FiveThirtyEight and Economist models.  -->

In addition to the 13 competitive races in our model, there are 22 additional races that are not considered competitive. Then there are also 65 other Senate seats that are not up for re-election this year. Note that the Georgia special election actually has multiple Republicans and Democrats running on the same ballot. If no candidate wins over 50% of the vote, which is considered likely, the top two finishers will advance to a one-on-one runoff election in January (Ballotpedia, 2020). For simplicity, our model simply sums up the support for Republican candidates and compares that to the sum of the support for Democratic candidates, then treats this election like the others. By summing the Republican and Democratic support, we essentially assume that partisan support will consolidate around one candidate for each party and will remain roughly balanced between the two parties. (This is not the ideal way to simulate this election, but the difficulty of predicting turnout and the political environment for the January runoff election made this decision seem like the best one to make.) Once again, we only included poll respones from likely voters that responded within 30 days of the election. 

The response we will use is $Y_k$, the Democrat candidate's share of the two-party vote using the following model where the poll $k$ (of $K$=*fill in* polls) ended $t$ days (of $T=60$ days) before the election and was conducted on state $j$ (of $J$=13 states of interest). 

$Y_k \sim N(\beta_{jt},\sigma^2_{yj})$ \newline
$\beta_{jt} \sim N(\beta_{jt-1},\sigma^2_{\beta j})$ \newline
Priors for $\sigma^2_{yj}$: \\
$\sigma^2_{yj} \sim InvGamma(\nu_u, \nu_y\tau_y)$ \newline
$\nu_y \sim Uniform(0,100)$ and $\tau_y \sim Uniform(0,100)$. \newline
Priors for $\sigma^2_{\beta j}$ \\
$\sigma^2_{\beta j} \sim InvGamma(\nu_{\beta}, \nu_{\beta}\tau_{\beta}))$ \newline
$\nu_{\beta} \sim Uniform(0,100)$ and $\tau_{\beta} \sim Uniform(0,100)$. \newline
Priors for $\beta_{j1}$ \\
$\beta_{j1} \sim N(\mu_{j}, \sigma^2)$  \newline
$\sigma^2 \sim InvGamma(0.5,0.5)$ \newline
$\mu_{j} \sim N(h_j,7.5^2)$  \newline
$h_j = \text{Vote Share from Partisan Lean}_j + \text{Incumbency Advantage}_j$  \newline

For the U.S. Senate model we also take the incumbency advantage into account. Analysis by FiveThirtyEight (Rakich, 2018) found that incumbent senators get a 2.6-point boost. For each incumbent was running a Senate race, depending on whether they were a Democrat or Republican, we either added or subtracted this incumbency adjustment with the prior mean computed from partisan lean.

For the NC-specific prior, we supplemented partisan lean and incumbency adjustment with voter turnout predicted by the model in our Interim Report. When computing the prior for NC only, 10% weight is allocated to predicted Democratic vote share from turnout and demographics, and 90% weight is allocated to partisan lean and incumbency adjustment. The turnout is weighted much less because there is considerable uncertainty surrounding turnout because of the COVID-19 pandemic. See Appendix A.2 for more specifics on how the voter turnout model was used to compute predicted Democratic vote share.

For predicting control of the U.S. Senate, things are complicated slightly by the fact that a 50/50 split of Senate seats is a possible outcome of the elections. In this case, the Vice President breaks the tie, so the party that wins the Presidential election will only need 50 Senate seats for a Senate majority, while the party that loses will need 51. Since our President model gives Democrat Joe Biden a very high chance of winning (discussed more below), we assume in the Senate model that Democrats will control the Senate in the case of a 50/50 split.

### House Election Model

The response we will use is $Y_k$, the Democrat candidate's two-party vote share using the following model where the poll $k$ (of $K$= 8 polls) ended $t$ days (of $T=30$ days) before the election and was conducted on district $j$ (where $j$ is in districts $1, \cdots, 11, 13$ of North Carolina). For district 12, the vote share is coded as 100 because there is only one candidate, and she is a Democrat. Note that, due to the scarcity of poll responses for the NC House elections, we included all poll responses within 115 days of the election.

$Y_k \sim N(\beta_{jt},\sigma^2_{yj})$ \newline
$\beta_{jt} \sim N(\beta_{jt-1},\sigma^2_{\beta j})$ \newline
$\sigma^2_{yj} \sim InvGamma(\nu_u, \nu_y\tau_y)$ \newline
$\nu_y \sim Uniform(0,100)$ and $\tau_y \sim Uniform(0,100)$. \newline
$\sigma^2_{\beta j} \sim InvGamma(\nu_{\beta}, \nu_{\beta}\tau_{\beta}))$ \newline
$\nu_{\beta} \sim Uniform(0,100)$ and $\tau_{\beta} \sim Uniform(0,100)$. \newline
$\beta_{j1} \sim N(h_j, 7.5)$  \newline
$h_j = 0.9*\text{Vote Share from Partisan Lean}_j + 0.1*\text{Expected Vote Share from Voter Turnout}_j$  \newline

According to FiveThirtyEight (Rakich, 2018),incumbent members of the House get a 2.7-point margin boost in their favor. For the U.S. House races, the incumbency adjustment was calculated by the same method as it was for the Senate races. $\text{Expected Vote Share from Voter Turnout}_j$ was calculated from the model in the Interim Report. Please see Appendix A.3 for more details. 


## Results

### Presidential Election Model

```{r read-in-pres-model, include = F}
jags_sims_mv = readRDS("pres_model_output.rds")
```

```{r biden-prob-win, include = F}
states = c("MN", "NH", "MI", "WI", "PA", "NV", "FL", "AZ", "NC", "GA", "IA", "OH", "TX")
N_states = length(states)
N_days = 30

elec_sims <- jags_sims_mv$BUGSoutput$sims.list$theta[,,1]
colnames(elec_sims) <- states
(elec_sims>50) %>% colMeans() #P(Biden Win) each state

#elec_sims <- jags_sims$BUGSoutput$sims.list$beta[,,1]
#colnames(elec_sims) <- states
#(elec_sims>50) %>% colMeans() #P(Biden Win) each state

#in other states: Biden: 232-13, Trump: 306-29-18-15-10-20
#b_ex_votes <- 232-13; t_ex_votes <- 306-29-18-15-10-20
```

```{r prob-trump-wins, include = F}
elec_votes_df = read.csv("electoral_votes.csv")

blue_EVs_2016 = sum(elec_votes_df$EV*elec_votes_df$blue2016) + 3 # DC
safe_blue_2020 = blue_EVs_2016  ## Will subtract states in model

ec_bystate = c()

for (st in states) {
  st_EVs = elec_votes_df[elec_votes_df$Abbrev==st,"EV"]
  ec_bystate = c(ec_bystate, st_EVs)
  
  if (elec_votes_df[elec_votes_df$Abbrev==st,"blue2016"] == 1) {
    safe_blue_2020 = safe_blue_2020 - st_EVs
  }
}

#ec_bystate = c(3, 9, 11, 55, 9, 3, 29, 16, 4, 6, 4, 11, 6, 8, 8, 11, 10, 4, 16, 10, 10, 6, 3, 15, 3, 4, 14, 5, 6, 29, 18, 7, 7, 20, 9, 3, 38, 0, 6, 11, 3, 12, 10, 5 )

ec_votes_inc_states <- ((elec_sims>50) %*% diag(ec_bystate)) %>% rowSums() #+ 232

ec_votes_dem = ec_votes_inc_states+safe_blue_2020 #anything else Biden should win (CT, Hawaii, IL, RI, DC)

# anything else for Trump (6 Arkansas, 5 Nebraska, 11 Tennessee, 3 S Dakota, 3 Wyoming) 

p_trump_win = 1 - mean(ec_votes_dem >= 270)
p_trump_win
```

```{r pres-plot, include = F, fig.height = 4, fig.width = 8, fig.cap = "\\label{trumpwintime} Probability of Re-election for President Trump over the 30 Days Before Election Day"}
trump_pwin_time = NULL
for (j in 1:N_states) {
  new_col = NULL
  for (t in 1:N_days) {
    new_col[t] <- mean(jags_sims_mv$BUGSoutput$sims.list$theta[,j,t] < 50)
  }
  trump_pwin_time = cbind(trump_pwin_time, new_col)
}
colnames(trump_pwin_time) <- states

trump_pwin_time  = as.data.frame(trump_pwin_time)%>%
  gather(., "state", "exp_pwin") %>%
  mutate(days_bf_election = rep(seq(1, N_days), N_states))

trump_line_plot = ggplot(trump_pwin_time, aes(x = days_bf_election, y = exp_pwin, color = state)) +
  geom_line() + geom_hline(yintercept = 0.5) + geom_vline(xintercept = 12, color = "blue") +
  scale_x_reverse() + 
  annotate("text", x = 10, y = 0.85, label = "2nd Debate", color = "blue") +
  labs(x = "Days Before Election", y = "Trump's Probability of Winning")+
  geom_dl(aes(label=state), method=list("last.points", cex = 0.6)) +
  theme(legend.position = "none")
```

```{r echo = F, fig.height = 4, fig.width = 10, fig.cap = "\\label{trumpmapline} Plot of Predicted Presidential Result for States of Interest on Election Day"}
pres_state_df = data.frame(state = states, pwin = (elec_sims>50) %>% colMeans())
pres_map = plot_usmap(data = pres_state_df, values = "pwin", color = "black") + 
  scale_fill_gradient2(low = "red", mid = "white", high = "blue", midpoint = 0.5,
                       aesthetics = "fill", name = "Predicted Probability of \n Voting Biden", label = scales::comma) + 
  theme(legend.position = "right")
grid.arrange(trump_line_plot, pres_map, nrow = 1)
```

Figure \ref{trumpmapline} shows how Trump's probability of winning the election changes over the 60 days before the election in each state of interest. It appears that his probability of winning increased after the last presidential debate. *check for final results* From Figure \ref{trumpmapline} we also see that swing states such as Florida and Ohio are predicted to vote for Trump while other swing states such as Pennsylvania and North Carolina are predicted to vote for Biden. *check for final results* 


```{r pres-res-table, echo = F}
pres_res = matrix(c(round(p_trump_win,2), 
                    round(1-p_trump_win,2),
                    as.character(round(538-mean(ec_votes_dem))),
                    as.character(round(mean(ec_votes_dem))),
                    as.character(round(538-quantile(ec_votes_dem,0.975))),
                    as.character(round(quantile(ec_votes_dem,0.025))),
                    as.character(round(538-quantile(ec_votes_dem,0.025))),
                    as.character(round(quantile(ec_votes_dem,0.975)))),
                    ncol = 2, byrow = TRUE)
colnames(pres_res) = c("Trump", "Biden")
rownames(pres_res) = c("Win Probability", "Estimated EC Votes",
                       "2.5% Quantile EC Votes", "97.5% Quantile EC Votes")
kable(t(pres_res), caption = "Predicted Probability of Winning and Electoral Vote Count")
```

The probability that Trump wins re-election is `r round(p_trump_win,2)`. The predicted electoral colleges votes for Trump is `r round(538-mean(ec_votes_dem),0)` with a 95% confidence interval of (`r round(538-quantile(ec_votes_dem,0.975))`, `r round(538-quantile(ec_votes_dem,0.025))`).

### Senate Election Model

```{r read-senate-model, include = F}
jags_sims = readRDS("senate_model_output.rds")
```

```{r democ-win-democ, include = F}
states = c("Alaska", "Arizona", "Colorado", "Georgia", "Georgia-Special", "Iowa", "Kansas", "Maine", "Michigan", "Montana", "North Carolina", "South Carolina", "Texas")
elec_sims <- jags_sims$BUGSoutput$sims.list$beta[,,1]
colnames(elec_sims) <- states
(elec_sims>50) %>% colMeans() 
```

```{r prob-republican-control, include = F}
preds = (elec_sims>50) %>% colMeans()
dem_wins = length(preds>0.5)

dem_seats_up = c("New Hampshire", "Minnesota", "Michigan", "Massachusetts", "Illinois", "Delaware", "Alabama", "New Jersey", "New Mexico", "Oregon", "Rhode Island", "Virginia")

dem_wins = c()

for (i in 1:nrow(elec_sims)) {
  preds = elec_sims[i,]
  dem_wins = rbind(dem_wins, sum(preds>50))
}

dem_noelection = 35

dem_safe = 0
for (st in dem_seats_up) {
  if ((!(st %in% states))&(!(st == "Alabama"))) {
    dem_safe = dem_safe + 1
  }
}

#dem_safe = length(safe_dem)

dem_seats = dem_noelection + dem_safe + dem_wins
prob_dem_control = mean(dem_seats >= 50)

#dem_needed = 50 - (dem_noelection + dem_safe)

#prob_dem_control = mean(dem_wins > dem_needed)

prob_rep_control = 1-prob_dem_control
prob_rep_control

# rep_noelection = 30
# rep_safe = length(safe_rep)
```

```{r include = F, fig.height = 4, fig.width = 8, fig.cap = "\\label{senateusmap} Plot of Predicted Senate Results for States of Interest on Election Day"}
senate_state_df$pwin = preds
senate_map = plot_usmap(data = senate_state_df, values = "pwin", color = "black") + 
  scale_fill_gradient2(low = "red", mid = "white", high = "blue", midpoint = 50,
                       aesthetics = "fill", name = "Predicted Probability of \n Win for Democrats", label = scales::comma) + 
  theme(legend.position = "right")
```


```{r echo = F, fig.height = 4, fig.width = 8, fig.cap = "\\label{senatemaphist} Plot of Predicted Senate Results for States of Interest on Election Day", warning = F, message = F}
dem_seats_df = data.frame(dem_seats)  
colnames(dem_seats_df) = "number_dem_seats"
dem_seats_df = dem_seats_df %>%
  mutate(blue = as.factor(ifelse(number_dem_seats >= 50, "Dem", "Rep")))

minimum = min(dem_seats_df$number_dem_seats)-1
maximum = max(dem_seats_df$number_dem_seats)+1

senate_hist = ggplot(dem_seats_df, aes(x = number_dem_seats, fill = blue)) + 
  geom_histogram(binwidth = 0.5) +
  scale_x_discrete(limits=(minimum+1):(maximum-0.5)) +
  scale_fill_manual(values=c("#0015BC","#FF0000")) + 
  labs(x = "Number of Democrat Seats", y = "Count", fill = "Party")
grid.arrange(senate_map, senate_hist, nrow = 1)
```

From Figure \ref{senatemaphist} we see that for the Senate race, states such as Texas are predicted to lean heavily towards the Republican candidate and Democrats have a great than 50% chance of winning states such as Arizona and Michigan. From the histogram in Figure \ref{senatemaphist} we see the distribution of the predicted number of Democrat seats point to a Democrat majority in the Senate, which is in agreement with the low probability that Republicans retain control of the Senate (`r round(prob_rep_control,2)`) in our model. 

```{r tillis-cunningham-table, echo = F}
elec_sims_df = data.frame(elec_sims)

#nc_index = which(states == "North Carolina")
cunningham_vote_share = mean(elec_sims_df$North.Carolina)
tillis_vote_share = 100 - cunningham_vote_share

cunningham_ci = quantile(elec_sims_df$North.Carolina, c(0.025, 0.975))
tillis_ci = c(100 - as.numeric(cunningham_ci[2]), 100-as.numeric(cunningham_ci[1]))

# tillis_vote_share
# tillis_ci

nc_senate_race = matrix(round(c(tillis_vote_share, tillis_ci,
                                cunningham_vote_share, cunningham_ci),2), 
                        nrow = 2, byrow = TRUE)
colnames(nc_senate_race) = c("Estimate", "2.5% Quantile", "97.5% Quantile")
rownames(nc_senate_race) = c("Tillis", "Cunningham")
kable(nc_senate_race, caption = "Predicted Vote Share for Tillis-Cunningham Race")
```

For the NC Senate race (Tillis vs. Cunningham), the predicted vote share for Cunningham is `r round(cunningham_vote_share,2)`% with a 95% confidence interval of (`r round(cunningham_ci[1],2)`, `r round(cunningham_ci[2],2)`).

## House Election Model

```{r read-house-model, include = F}
jags_sims_house = readRDS("house_model_output.rds")
```

```{r, include = F}
districts <- paste("District",c(1:13))

elec_sims <- jags_sims_house$BUGSoutput$sims.list$beta[,,1]
colnames(elec_sims) <- districts
#(elec_sims>50) %>% colMeans() #P(Biden Win) each state
```

```{r, include = F}
dem_vote_shares = elec_sims %>% apply(2, mean)
dem_vote_shares[12] = 100

rep_vote_shares = 100 - dem_vote_shares
rep_vote_shares
```

```{r, include = F}
dem_intervals = elec_sims %>% apply(2, quantile, probs=c(0.025, 0.975))
dem_intervals = unname(dem_intervals)
dem_intervals[1,12] = 99.8
dem_intervals[2,12] = 100

rep_intervals = 100 - dem_intervals

for (i in 1:length(districts)) {
  print(districts[i])
  print(rep_intervals[2,i])
  print(rep_intervals[1,i])
  cat("\n")
}
```

```{r, echo = F}
house_res = matrix(round(rbind(rep_vote_shares, rep_intervals),2), nrow = 13, byrow = TRUE)
house_res = house_res[, c(1,3,2)]
house_res[12,3] = 0
colnames(house_res) = c("Estimate", "2.5% Quantile", "97.5% Quantile")
rownames(house_res) = c("District 1", "District 2", "District 3", "District 4",
                        "District 5", "District 6", "District 7", "District 8",
                        "District 9", "District 10", "District 11", "District 12", "District 13")
kable(house_res, caption = "Predicted Republican Vote Share in NC's 13 Districts")
```

```{r, include = F, message = F, warning = F}
download.file("https://webservices.ncleg.gov/ViewBillDocument/2019/6953/0/HB%201029,%203rd%20Edition%20-%20Shapefile", destfile = "nc_map.zip")

system("unzip nc_map.zip")

nc_cong_dist <- rgdal::readOGR("C-Goodwin-A-1-TC.shp")

```

```{r, echo = F, fig.height = 3, fig.width = 6,  message = F, warning = F, fig.cap = "\\label{housemap} Plot of Predicted Senate Results for States of Interest on Election Day"}

# 'fortify' the data to get a dataframe format required by ggplot2
nc_cong_dist_df <- broom::tidy(nc_cong_dist, region = "DISTRICT")
rep_vote_shares_df = data.frame(dist = seq(1:13), vote_share = rep_vote_shares)
nc_cong_dist_vs_df = merge(nc_cong_dist_df,rep_vote_shares_df, all.x = TRUE, by.x = "id", by.y = "dist" ) %>%
  mutate(binned_rep_vs = case_when(
    vote_share >= 75 ~ 4,
    vote_share >= 50 ~ 3,
    vote_share >= 25 ~ 2,
    vote_share >= 0 ~ 1,
    TRUE ~ vote_share
  )) %>%
  mutate(dist_color = case_when(
    binned_rep_vs == 1 ~ "#0015BC",
    binned_rep_vs == 2 ~ "#B0CEFF",
    binned_rep_vs == 3 ~ "#FFCCCB",
    binned_rep_vs == 4 ~ "#FF0000",
    TRUE ~ ""
  ))

# use midpoint of county to find where labels should go
rnames <- aggregate(cbind(long, lat) ~ id, data=nc_cong_dist_vs_df, 
                    FUN=function(x) mean(range(x)))

# adjust where labels should go because counties aren't exactly square
rnames$lat[which(rnames$id==11)] = rnames$lat[which(rnames$id==11)]-20500
rnames$lat[which(rnames$id==10)] = rnames$lat[which(rnames$id==10)]+25000
rnames$lat[which(rnames$id==13)] = rnames$lat[which(rnames$id==13)]-20000
rnames$long[which(rnames$id==13)] = rnames$long[which(rnames$id==13)]-12000

rnames$lat[which(rnames$id==8)] = rnames$lat[which(rnames$id==8)]+10500
rnames$long[which(rnames$id==8)] = rnames$long[which(rnames$id==8)]+8000

rnames$lat[which(rnames$id==9)] = rnames$lat[which(rnames$id==9)]+20500
rnames$long[which(rnames$id==7)] = rnames$long[which(rnames$id==7)]-20000
rnames$lat[which(rnames$id==7)] = rnames$lat[which(rnames$id==7)]-18000

rnames$lat[which(rnames$id==3)] = rnames$lat[which(rnames$id==3)]-20500

ggplot() +
  geom_polygon(data = nc_cong_dist_vs_df, 
               aes(x = long, y = lat, group = group, fill = vote_share),
               #fill=nc_cong_dist_vs_df$dist_color#,"#0015BC", "#B0CEFF"),
               color="white") +
    scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 50,
                       aesthetics = "fill", name = "Republican Vote Share", label = scales::comma) + 
      geom_text(data=rnames, aes(long, lat, label = id), size=3) + theme_void()
```

From the table of predicted Republican vote share in the House elections for each district, it appears that the Republican candidate will win in districts 3, 5, 7, 8, 9, 10, 11, and 13 (where the lower bounds of the 95% confidence intervals for predicted vote share are also all above 50). From Figure \ref{housemap} we can see that the vote share for districts 1, 2, 4, and 6 lean toward Democrat (note that the only candidate on the ballot for district 12 is a Democrat).


## Model Validation and Sensitivity Analysis

For model validation, we trained our 2020 presidential election model on 2016 polling data and adjusted fundamentals accordingly. For instance, instead of predicting 2020 economic indicators, we removed the year 2016 from the fundamentals training data and predicted 2016 economic indicators. This 2016 model produced a 7% probability that Trump would win the presidency, which is within the range of predictions by respected models available in 2016 (The Economist, 2016). Polls were skewed in 2016, so it is expected that the model would not be entirely accurate.

For sensitivity analysis, we adjusted the relative weights placed on the components prior to the presidential election model. Instead of 10% fundamentals and 90% partisan lean, we ran a model with 50% fundamentals and 50% partisan lean multiple times and the predictions for Trump's re-election probability was generally higher (approximately 0.25) than that from our main model, which makes sense since economic fundamental model contains stock growth and is slightly favored toward Trump. However, the sensitivity analysis models still point to unlikely re-election.

We also adjusted the prior parameters for sensitivity analysis. In both the senate and house model, changing the priors from $\nu_y, \tau_y, \nu_\beta, \tau_\beta \sim Uniform(0,100)$ to $\nu_y, \nu_\beta \sim Uniform(0,10), \tau_y, \tau_\beta \sim Uniform(0,1000)$ to increase the variance had little change on the estimates. Changing the relevant uniform priors in the presidential model resulted in a slightly higher probability of Trump's re-election (the probability was about 0.23), but again, this still indicates Using a stronger prior for the variance for the estimate on the day of the election ($\sigma^2 \sim InvGamma(10,0.5)$) for the senate and presidential models resulted in comparable performance to our main senate model while the presidential model had higher win probabilities and slightly narrower credible intervals for Trump compared to our main model (the win probability was about 0.34). Similarly, reducing the variance for the house model ($\beta_{ji} \sim N(h_j, 1)$) also resulted in a similar performance, though the quantiles were more narrow, as expected (Linzer, 2013). To account for shock events, we could modify the priors to increase the variance associated with $Y_k$ to reflect the increased uncertainty due to the shock event in each relevant model. 

## Diagnostics

The MCMC for all three models (presidential, senate, house) have all converged, as indicated by traceplots in Appendix C. In addition, the effective sample sizes are generally above 500.

```{r resid for president, echo=F, fig.height=4, fig.width=8, fig.cap = "\\label{presresid} Presidential Model Residual Plot", warning = F, message = F}
require(reshape2)
Result_MCMC <- as.mcmc(jags_sims_mv)
Result_data <- data.frame(as.matrix(Result_MCMC))
ResidualName <- seq(1, N_states)
for( idx in 1:N_states) {
  ResidualName[idx] <- capture.output(cat( c("res", idx, 2, ""), sep = "."))
}
residul_check <- Result_data[, ResidualName]
resid_df = melt(residul_check) %>%
  mutate(state = rep(c("MN", "NH", "MI", "WI", "PA", "NV", "FL", "AZ", "NC", "GA", "IA", "OH", "TX"), rep(3000,13)))

ggplot(data = resid_df, aes(x=state, y=value, group = state)) + #scale_x_discrete(breaks = seq(1,13)) + 
  geom_boxplot(aes(fill=variable), outlier.size = 0.1) + theme(legend.position = "none") + labs(y = "Residuals", x = "Observation", title = "Boxplot of Presidential Model Residuals the Day Before the Election") + theme(legend.position = "none") + labs(x = "States", y= "Residuals")
```

As shown in Figure \ref{presresid}, the residuals for the estimates of the probability that Biden wins the election are distributed around 0 for all of the states of interest. Residuals for Senate and House race are in Appendix C.

## Discussion and Limitations

One place where we made decisions regarding the predictive ability of variables was in the presidential election model. We followed Alan Abramowitz’s “Time for Change” model where annualized second-quarter GDP growth rates and the incumbent party’s June approval ratings were incorporated as the fundamentals data (Abramowitz 2008). However, given the economic impact of COVID-19, this year’s annualized second-quarter GDP growth rate is abnormally low (-34%) (BEA, 2020), which subsequently resulted in a very low predicted probability of Trump’s re-election (approximately 5%). Therefore we felt annualized second-quarter GDP growth rate is not an appropriate predictor and substituted it with second-quarter real income growth from one year ago and stock performance three months prior to the election date. As seen in the Results section, the updated predicted probability of Trump winning the election is more sensible. 

For the NC House election model and NC Senate election model, we incorporated the voter turnout prediction based on registered voters' demographics from the Interim Report. We believe that even if we had abundant polling data, there's a difference between how people respond to a poll and whether or not they actually turn out to vote. Therefore, we included turnout information from our interim model.

A limitation of our model is that we did not explicitly weigh any polls more strongly than others. Poll-based models often weight polls based on recency of the poll, sample size, and pollster quality (Silver, 2014). Our model actually does take into account poll recency, since our prior specification assumes that polls closer to election day have less variance (noise) around the true level of candidate support. However, we do not weight based on sample size or pollster quality. While it would have been possible to do this, it would have required making many arbitrary decisions. For example, what is a "good" sample size, and how heavily should the sample size be weighted? How do we determine pollster quality, especially if we don't just want to blindly use FiveThirtyEight's pollster ratings? We decided to avoid these issues, especially since it has been observed that such adjustments rarely have a large impact on models (Silver, 2014).

There are inherent limitations to modeling elections based on polls. In some cases, as with the U.S. House races in North Carolina, there may be few or no polls for a given district. Even when polling data is plentiful, we are essentially assuming that the polls are reasonably accurate measures of candidate support. It has been well-documented that systematic polling errors during the 2016 election cycle underestimated the support of then-candidate Trump. While many pollsters have adjusted their sample weighting methods (for example, to adjust for education level), it is not impossible that we could witness a 2016-level polling error again (Skelley, 2020). A recent election prediction study shows that state polls have much higher margins of error than expected (Shirani-Mehr et al., 2018). It has also been noted that registered Democrats have been overrepresented in recent polling samples compared to their proportion of the population overall (Cohn, 2020). In addition, we acknowledge that with the COVID-19 pandemic, polling has moved from in-person interviews to phone calls, live surveys, and internet questions, which could lead to unknown biases with its lower response rates (Gelman, 2020). In addition, COVID-19 posted significant uncertainty in election outcomes. For example, rejected absentee ballots due to mailing issues were not as significant in previous elections. But in 2020, so much more voters are mailing their votes, and an unknown number of them will be rejected, potentially changing voter turnout (Rakich, 2020). We could have also used early voting data, but we excluded them because abundant literature has proven early voting data to have a strong partisan bias (McDonald, 2020). Another factor that could significantly affect election results is potential shock events - terrorist attacks, natural disasters, power outages. Although literature proves that sometimes elections could be vulnerable to those events, because our predictions are so close to the actual day of the election, we did not account for specific shock events in our analysis (Morley, 1905). However, we did sensitivity analysis by increasing variance to account for unpredictable events.

One feature that we did not include is the correlation between simulations of the Presidential, House, and Senate elections. For instance, if Joe Biden wins the Presidential election by a wide margin, we would also expect Democrats to do better in the House and Senate elections compared to if Biden did not win (Desilver, 2020). This is especially true by state; if Biden wins North Carolina by a wide margin, this would likely help Democrat Cal Cunningham win the NC Senate race. Additionally, since the Vice President can determine Senate control in the case of a 50/50 split in seats, having model correlations could help account for this dependence between Senate control and Presidential results. Instead, all of our models simply run independently.

We do account for state-by-state correlations in our President model, but we do not for the Senate model or the House model. Although there is likely still some correlation in these cases, such races are generally a bit more localized (Gillespie et al. 2020) and incumbency advantages can contradict national trends. As a result, we treated these races as being uncorrelated. Possible ideas for addressing this in future studies could be to try to compute our own covariances between districts based on voter demographics, or for the Senate to try predicting covariance between states that is similar to that in the Presidential model but "weaker".

Furthermore, for making our prior to Democrat vote share in the House and Senate model (for NC), we assume that registered Democrats and Republicans will vote for their party's candidate, and then we split unaffiliated voters evenly between the two parties. FiveThirtyEight's models such as the 2020 President and Senate models allocate undecided voters in polls 50/50 as well, so our assumption is in line with standard approaches. However, other reasonable approaches could have been to allocate unaffiliated voters proportionally to partisan support within the state of interest or even to calculate the split based on Trump's overperformance of polls in 2016 based on winning over undecided voters (Golshan, 2016). Such approaches have been explored in the past by FiveThirtyEight (Silver, 2008) but are not the norm.

## Conclusion

In conclusion, the probability that Trump wins re-election is `r round(p_trump_win,2)`. The predicted electoral colleges votes for Trump is `r round(538-mean(ec_votes_dem),0)`. We predict that the US Senate is unlikely to remain in Republican control (in fact, we predict there is only a `r round(prob_rep_control,2)` chance that Republicans retain control)
For the House elections in NC's 13 districts, it appears that the Republican candidate will win in districts 3, 5, 7, 8, 9, 10, 11, and 13 and that the Democratic candidate will win districts 1, 2, 4, and 6. For the NC Senate race (Tillis vs. Cunningham), the predicted vote share for Cunningham is `r round(cunningham_vote_share,2)`%, and we predict that he will win by a small margin. *check to see if nothing changes* 

Key parts of our model include the incorporation of a state covariance matrix and the use of economic fundamentals in our presidential model, the incumbency adjustment in our Senate model, and the inclusion of voter turnout information in our NC House model. As mentioned before, there are several limitations, but overall, we believe our analysis to be thorough and robust. 

\pagebreak 

# Appendix A

## A.1 Presidential Election Model

### Presidential Model Purpose and Structure

The purpose of this model is to predict the probability that president Trump will win the election, as well as to predict the electoral college vote. The states chosen are Arizona, Florida, Georgia, Iowa, Michigan, Minnesota, Nevada, New Hampshire, North Carolina, Ohio, Pennsylvania, Texas, and Wisconsin. These thirteen states are deemed to be competitive in the 2020 presidential race by political analysts.

The response we will use is $Y_k$, Biden's share of the two-party vote using the following model where the poll $k$ (of $K$=*3361 [insert final number]* polls) ended $t$ days (of $T=30$ days) before the election and was conducted on state $j$ (of $J$=13 states of interest). We choose to use polling data from 30 days before the election (as opposed to over 30 days), as this aligns with Andrew Gelman's observation that polling data becomes more predictive as the day of poll becomes closer to election day (The Economist).

$Y_k \sim N(\theta_{jt},\sigma^2_{yj})$ \newline
$\theta_{\cdots t} \sim MVN(\theta_{\cdots t-1},\Sigma)$ \newline
$\Sigma \sim Wishart(S, J+1)$ where $S$ is the state covariance matrix (obtained from Andrew Gelman's model) and $J$ is the number of states in the model. \newline
Priors for $\sigma^2_{yj}$: 
$\sigma^2_{yj} \sim InvGamma(\nu_u, \nu_y\tau_y)$ \newline
$\nu_y \sim Uniform(0,100)$ and $\tau_y \sim Uniform(0,100)$. \newline
Priors for $\theta_{j1}$: 
$\theta_{j1} \sim N(\mu_{j}, \sigma^2)$  \newline
$\sigma^2 \sim InvGamma(0.5, 0.5)$ \newline
$\mu_{j} \sim N(h_j,7.5^2)$  \newline
$h_j = 0.1*\hat{\text{Presidential Fundamentals}_{2020}} + 0.9*\text{Vote Share from Partisan Lean}_j$  \newline
$\text{Presidential Fundamentals}_i = 100 - \text{Incumbent Party Vote Share}_i$ \newline
$\text{Incumbent Party Vote Share}_i= \gamma_0 + \gamma_1\text{June Approval Rating for Incumbent Party}_i + \gamma_2\text{Three Month Stock Growth}_i + \gamma_3\text{2nd Quarter Real Income Growth}_i +\epsilon_i$  \newline
$\epsilon_i \sim N(0, \phi^2)$  \newline

A hierarchical model was used, where Biden's share of the two-party vote for poll $k$ on any given day $t$ for state $j$ is modelled as a normal distribution with mean $\theta_{jt}$ and variance $\sigma^2_{yj}$. A random walk was used to calculate $\theta_{jt}$ for each day $t$ before the election (up until 30 days before the election) from $\theta_{j t-1}$ and $\Sigma$, a $JxJ$ state covariance matrix. The mean $h_j$ of the normal prior on $\mu_j$ (which is the mean of the normal prior on $\theta_{j1}$) was calculated by multiplying the economic fundamentals $\text{Presidental Fundamentals}_i$ for $i = 2020$ by 0.1 and state partisan lean by 0.9, then summing those two values. 

We predicted $\text{Incumbent Party Vote Share}_{2020}$ (i.e. Republican Party's national vote share in the 2020 election) from a linear regression model that had historical election year's June approval rating of the incumbent party, three month stock growth, and 2nd quarter real income growth as predictors. We borrowed this idea from the "Time for Change" model which assumes that presidential election is referendum on the performance of incumbent president (Alan Abramowitz, 2008). Then we used 100 minus $\text{Incumbent Party Vote Share}_{2020}$ to obtain the predicted vote share for Democrats ($\text{Presidential Fundamentals}_{2020}$). 

### Raw Model Output

```{r, echo = F}
options(max.print = 999999999)

pres_res = as.data.frame(jags_sims_mv$BUGSoutput$summary[,-c(4,5,6,8,9)])

no_p = pres_res[!grepl("p", rownames(pres_res)),]
no_deviance = no_p[!grepl("deviance", rownames(no_p)),]
no_res = no_deviance[!grepl("res", rownames(no_deviance)),]

var_want = sapply(1:13, {function(x) c(paste0("Sigma[", x, ",1]"),
                                         paste0("theta[", x, ",1]"),
                                         paste0("sigma2_y[", x, "]"))})

final_raw_output = no_res[ rownames(no_res) %in% var_want,]

final_raw_output

cat("mean Rhat:", mean(as.data.frame(jags_sims_mv$BUGSoutput$summary)$Rhat), '\n')
cat("mean effective sample size:", mean(as.data.frame(jags_sims_mv$BUGSoutput$summary)$n.eff))
```

Since the outcome of the election is decided by Electoral College vote, for each set of MCMC samples of the two-party vote share by state, we use the predicted winner in each state $j$ on the day of the election ($\beta_{j1}$) and sum the electoral votes from those states for each candidate. For states not in the model, votes were given to the candidates based on how the states voted in 2016. The probability of President Trump winning re-election is the probability that he receives 270 or more electoral votes across simulations. (Note: Maine and Nebraska do not have a "winner-take-all" framework for allocating votes, but for simplicity, we assume that they have the same vote-allocating procedures as the other states).

## A.2 Senate Election Model

The purpose of the Senate model is to predict whether the U.S. Senate remains in Republican control (and to predict the outcome for the NC Senate race). The states included in the model are Alaska, Arizona, Colorado, Georgia, Iowa, Kansas, Maine, Michigan, Montana, North Carolina, South Carolina, and Texas. These states were chosen because they are deemed by political analysts as being competitive states for the Senate race in 2020. There is also a special election for the Senate in Georgia in addition to the regularly scheduled election. For the Georgia special election, our model sums up the support for Republican candidates and compares that to the sum of the support for Democratic candidates, and treats this election in the same way as the other states.

The response we will use is $Y_k$, the Democrat candidate's share of the two-party vote using the following model where the poll $k$ (of $K$=*fill in* polls) ended $t$ days (of $T=30$ days) before the election and was conducted on state $j$ (of $J$=14 states of interest). 

$Y_k \sim N(\beta_{jt},\sigma^2_{yj})$ \newline
$\beta_{jt} \sim N(\beta_{jt-1},\sigma^2_{\beta j})$ \newline
Priors for $\sigma^2_{yj}$:
$\sigma^2_{yj} \sim InvGamma(\nu_u, \nu_y\tau_y)$ \newline
$\nu_y \sim Uniform(0,100)$ and $\tau_y \sim Uniform(0,100)$. \newline
Priors for $\sigma^2_{\beta j}$
$\sigma^2_{\beta j} \sim InvGamma(\nu_{\beta}, \nu_{\beta}\tau_{\beta}))$ \newline
$\nu_{\beta} \sim Uniform(0,100)$ and $\tau_{\beta} \sim Uniform(0,100)$. \newline
Priors for $\beta_{j1}$
$\beta_{j1} \sim N(\mu_{j}, \sigma^2)$  \newline
$\sigma^2 \sim InvGamma(0.5,0.5)$ \newline
$\mu_{j} \sim N(h_j,7.5^2)$  \newline
$h_j = \text{Vote Share from Partisan Lean}_j + \text{Incumbency Advantage}_j$  \newline

A hierarchical model was used, where the Democratic candidate's share of the two-party vote for poll $k$ on any given day $t$ for state $j$ is modeled as a normal distribution with mean $\beta_{jt}$ and variance $\sigma^2_{yj}$. A random walk was used to calculate $\beta_{jt}$ for each day $t$ before the election (up until 30 days before the election) from $\beta_{j t-1}$ and $\sigma_{\beta j}$. The mean $h_j$ of the normal prior on $mu_j$ (which is the mean of the normal prior on $\beta_{j1}$), was calculated by the sum of the $\text{Vote Share from Partisan Lean}_j$ and $\text{Incumbency Advantage}_j$.

### Raw Model Output

```{r, echo = F}
options(max.print = 999999999)

pres_res = as.data.frame(jags_sims$BUGSoutput$summary[,-c(4,5,6,8,9)])

no_p = pres_res[!grepl("p", rownames(pres_res)),]
no_deviance = no_p[!grepl("deviance", rownames(no_p)),]
no_res = no_deviance[!grepl("res", rownames(no_deviance)),]

var_want = sapply(1:13, {function(x) c(paste0("sigma2_beta[", x, "]"),
                                         paste0("beta[", x, ",1]"),
                                         paste0("sigma2_y[", x, "]"))})

final_raw_output = no_res[ rownames(no_res) %in% var_want,]

final_raw_output

cat("mean Rhat:", mean(as.data.frame(jags_sims$BUGSoutput$summary)$Rhat), '\n')
cat("mean effective sample size:", mean(as.data.frame(jags_sims$BUGSoutput$summary)$n.eff))
```

For predicting control of the U.S. Senate, if a 50/50 split is predicted, then the VP breaks the tie. In this case, we predict Democrat majority since our presidential model gives Biden a high chance of winning (and a Democrat VP will break the tie).

## A.3 House Election Model

### House Model Purpose and Structure

The purpose of the House model is to predict which candidate in each of NC's 13 congressional districts will win in their respective elections. 

The response we will use is $Y_k$, the Democrat candidate's share of the two-party vote using the following model where the poll $k$ (of $K$=*fill in* polls) ended $t$ days (of $T=60$ days) before the election and was conducted on district $j$ (where $j$ is in districts $1, \cdots, 11, 13$ of North Carolina). For district 12, the vote share is coded as 100 because there is only one candidate, and she is a Democrat. Note that, due to the scarcity of poll responses for the NC House elections, we included all poll responses within 115 days of the election.

$Y_k \sim N(\beta_{jt},\sigma^2_{yj})$ \newline
$\beta_{jt} \sim N(\beta_{jt-1},\sigma^2_{\beta j})$ \newline
$\sigma^2_{yj} \sim InvGamma(\nu_u, \nu_y\tau_y)$ \newline
$\nu_y \sim Uniform(0,100)$ and $\tau_y \sim Uniform(0,100)$. \newline
$\sigma^2_{\beta j} \sim InvGamma(\nu_{\beta}, \nu_{\beta}\tau_{\beta}))$ \newline
$\nu_{\beta} \sim Uniform(0,100)$ and $\tau_{\beta} \sim Uniform(0,100)$. \newline
$\beta_{j1} \sim N(h_j, 7.5)$  \newline
$h_j = 0.9*\text{Vote Share from Partisan Lean}_j + 0.1*\text{Expected Vote Share from Voter Turnout}_j$  \newline

A hierarchical model was used, where the Democratic candidate's share of the two-party vote for poll $k$ on any given day $t$ for district $j$ is modelled as a normal distribution with mean $\beta_{jt}$ and variance $\sigma^2_{yj}$. A random walk was used to calculate $\beta_{jt}$ for each day $t$ before the election (up until 30 days before the election) from $\beta_{j t-1}$ and $\sigma_{\beta j}$. The mean $h_j$ of the normal prior on $mu_j$ is computed by multiplying $\text{Vote Share from Partisan Lean}_j$ by 0.9 and $\text{Expected Vote Share from Voter Turnout}_j$ by 0.1, then summing those two values.

### Interim Report Model

$$
\begin{aligned}
Vote_i \sim Binomial(n_i, \pi_i) \\
logit(\pi_i) = \alpha_0 + \Sigma_{j = 1,2,3}\beta_{j}*I(Income_i = Income \ Category_s) + \Sigma_{j = 5,6}\beta_j*I(Gender_i = Gender \ Category_g) +\\
\Sigma_{j = 7,8}\beta_j*I(Race_i = Race \ Category_r) + \Sigma_{j = 9,10,11}\beta_j*I(Age_i = Age \ Category_a) +\\
\Sigma_{j = 12,13}\beta_j*I(Party_i = Party \ Category_p) + \\
\Sigma_{j = 14,...,17}\beta_j*I(Gender_i = Gender \ Category_g)I(Party_i = Party \ Category_p) + \\
\Sigma_{j = 18,...,21}\beta_j*I(Race_i = Race \ Category_r)I(Party_i = Party \ Category_p) + \\
\Sigma_{j = 22,...,27}\beta_j*I(Gender_i = Gender \ Category_g)I(Age_i = Age \ Category_a) + \\
\Sigma_{j = 28,...,33}\beta_j*I(Party_i = Party \ Category_p)I(Age_i = Age \ Category_a) 
\end{aligned}
$$

where:

$$
\begin{aligned}
Income \ Category_s &\in \{Median \ Income \ \$46864-\$52798, \ Median \ Income \ \$52798-\$64509, \\ &\ Median \ Income > \$64509\} \\
Gender \ Category_g &\in \{Male, Unspecified\} \\
Race \ Category_r &\in \{Black, Other\} \\
Age \ Category_a &\in \{Age \ 30-44, \ Age \ 45-59, \ Age \ 60+\} \\
Party \ Category_p &\in \{Republican, \ Other\}
\end{aligned}
$$

Where $\pi_i$ is the probability that subgroup $i$ votes. $Vote_i$ is the number of people in the $i$th subgroup that voted in the 2016 election. The baseline is `Median Income < $46864` for income, `Female` for gender, `White` for race, `18-29` for age, and `Democrat` for party affiliation.

We fit the voter turnout model from the Interim Report on the 2020 registered voter dataset. The predicted values were the number of people that will vote for each demographic subgroup in each congressional district. We made a reasonable assumption that if someone is registered as a Democrat, that they will indeed vote for the Democratic candidate (and made the same assumption for registered Republicans). If the demographic subgroup had third/unaffiliated party, then we split their predicted number of voters evenly between the Democrat and Republican parties. From this, we calculated Democratic party vote share for each district by taking the ratio of the predicted number of Democratic voters to total number of registered voters in that district. 

### Raw Output for Appendix

```{r, echo = F}
options(max.print = 999999999)

pres_res = as.data.frame(jags_sims_house$BUGSoutput$summary[,-c(4,5,6,8,9)])

no_p = pres_res[!grepl("p", rownames(pres_res)),]
no_deviance = no_p[!grepl("deviance", rownames(no_p)),]
no_res = no_deviance[!grepl("res", rownames(no_deviance)),]

var_want = sapply(1:13, {function(x) c(paste0("sigma2_beta[", x, "]"),
                                         paste0("beta[", x, ",1]"),
                                         paste0("sigma2_y[", x, "]"))})

final_raw_output = no_res[ rownames(no_res) %in% var_want,]

final_raw_output

cat("mean Rhat:", mean(as.data.frame(jags_sims_house$BUGSoutput$summary)$Rhat), '\n')
cat("mean effective sample size:", mean(as.data.frame(jags_sims_house$BUGSoutput$summary)$n.eff))
```

\newpage

# Appendix B

### Presidential Election Model: 
 + `2020 US presidential election polls - all_polls.csv`: 2020 U.S. Presidential Election Polls compiled by *The Economist*. Available at https://projects.economist.com/us-2020-forecast/president/how-this-works. 
        + We only used poll responses from likely voters in the battleground states within 30 days prior to the election date. From the poll responses we calculated Biden's vote share in the two-party race in each poll ($Y_k$).

 + `partisan_leans_538.csv`: effect of partisan lean on the Democratic candidate's presidential election vote share in each state. Available at https://github.com/fivethirtyeight/data/tree/master/partisan-lean.
        + 90% weight is allocated to this variable $\text{Vote Share from Partisan Lean}_j$ when computing hyperparameter $h_j$ for each state $j$. 
        
 + `abramowitz_data.csv`: downloaded from Andrew Gelman's Github repository on the 2020 Presidential Election. Available at https://github.com/TheEconomist/us-potus-model.
        + This data set contains information on each of the 1948-2016 election year $i$'s annualized 2nd quarter GDP performance (not used due to its abnormally low value in 2020), incumbent party's June net approval rating ($\text{June Approval Ratings for Incumbent Party}_i$) and incumbent party's national vote share ($\text{Presidental Fundamentals}_i$). 
        
 + `states_cov_matrix_full.csv`: covariance matrix of states which takes into account similarity between states based on their demographic and political profiles. Retrieved from Andrew Gelman's Github repository on the 2020 Presidential Election (https://github.com/TheEconomist/us-potus-model). 
        + The covariance matrix corresponds to $S$, the scale matrix in the prior distribution of $\Sigma$ 
        
 + `abramowitz_additional.csv`: we supplemented `abramowitz_data.csv` with the corresponding year $i$'s 2nd quarter real income growth compared to one year ago ($\text{2nd Quarter Real Income Growth}_i$) and S&P stock performance 3 months prior to the election date ($\text{Three Month Stock Growth}_i$). Data sets are from https://fred.stlouisfed.org/series/A067RO1Q156NBEA and https://www.multpl.com/s-p-500-historical-prices/table/by-month. A subset of the combined data set is displayed below. *check where the table is*
        + We fitted a linear regression model on historical incumbent party's national vote share with $\text{June Approval Ratings for Incumbent Party}$, $\text{2nd Quarter Real Income Growth}$, and $\text{Three Month Stock Growth}$ as predictors. We then predicted this year's incumbent party's national vote share (i.e. Republican's national vote share) and used 100 minus the predicted value to obtain Democrat's national vote share ($\text{Presidental Fundamentals}_{2020}$). We can think of $\text{Presidental Fundamentals}_{2020}$ as a national level prior. 10% weight is allocated to the "national prior" when computing the state specific prior $h_j$.

```{r pres-fundamentals-table-kable, echo=F}
abramowitz <- read.csv('abramowitz_additional.csv') 
abramowitz_display <- abramowitz %>%
  select(year, incvote, deminc, juneapp, q2gdp, three_month_stock_growth,q2_real_income_growth) %>%
  mutate(deminc = case_when(deminc == "1" ~ "Yes",
                            TRUE ~ "No")) %>%
  arrange(desc(year)) %>%
  head() 

names(abramowitz_display) <- c("Year", "Incumbent Party Vote Share", "Democrat Incumbency", "Incumbent Party June Net Approval", "2nd Quarter GDP Growth", "3 Month Stock Growth", "2nd Quarter Real Income Growth")

abramowitz_display %>%
  kable()

```



### Senate Election Model: 
 + `senate_polls.csv`: Senate election polls compiled by *FiveThirtyEight*. Available at https://projects.fivethirtyeight.com/polls-page/senate_polls.csv. 
        + Similar to the presidential election prediction model, we only included poll responses from likely voters in the battleground states within 30 days prior to the senate election date. From the poll responses we calculated Democratic candidates' vote share in the two-party race in each poll ($Y_k$).
 + `partisan_leans_538.csv`: same as the data set in presidential election model and we used this partisan lean in the calculation of prior hyperparameter $h_j$.
 + We also incroporated incumbency advantage in calculating $h_j$. As *FiveThirtyEight* suggests, incumbency advantage is on average 2.6 for senate incumbents (https://fivethirtyeight.com/features/how-much-was-incumbency-worth-in-2018/).
 + For NC Senate race only, we supplemented the prior with predicted voter turnout from the Interim Report model. 

### House Election Model (for North Carolina):
 + `house_polls.csv`: House election polls compiled by *FiveThirtyEight*. Available at https://projects.fivethirtyeight.com/polls-page/house_polls.csv. 
        + We only used polls related to the NC House race. Due to the lack of poll responses for the NC House elections, we included all poll responses within 115 days of the election. 
 + `ncvoter_1027_small.rds`: NC registered voter demographics information provided by the NC State Board of Elections (https://dl.ncsbe.gov/list.html). 
        + Please refer to the Interim Report to see a detailed explanation of how voter turnout is modeled by registered voters' race, age, party affiliation, income and gender. 
 + Partisan lean and incumbency information was taken from *FiveThirtyEight* at the following links, respectively:  https://fivethirtyeight.com/features/north-carolinas-new-house-map-hands-democrats-two-seats-but-it-still-leans-republican/, https://fivethirtyeight.com/features/how-much-was-incumbency-worth-in-2018/


# Appendix C 

## Additional EDA

```{r Additional EDA, echo=F, fig.width=8,fig.height=4, fig.align='center', fig.cap="Additional Presidential Election Data Visualization"}
#number of polls for each state in the economist paper data set
plot_usmap(data = econ_state_df, values = "n", color = "red") + 
  scale_fill_continuous(name = "Number of Polls", label = scales::comma) + 
  theme(legend.position = "right") + labs(title = "Map For The Number of Filtered Polls Among States")
```

```{r Additional EDA Senate, echo=F, fig.width=8,fig.height=4, fig.align='center', fig.cap="Additional Senate Election Data Visualization"}
#number of polls for senate
plot_usmap(data = senate_state_df, values = "n", color = "red") + 
  scale_fill_continuous(name = "Number of Polls", label = scales::comma) + 
  theme(legend.position = "right") + labs(title = "Map For The Number of Filtered Polls Among States")
```

## Traceplots for Presidential Model

```{r, echo = F}
states = c("MN", "NH", "MI", "WI", "PA", "NV", "FL", "AZ", "NC", "GA", "IA", "OH", "TX")
N_states = length(states)

betas_day_of_election = sapply(1:N_states, function(i) {paste0("theta.", i, ".1.")} )
parameters = c(betas_day_of_election)

tp_vars = data.frame(jags_sims_mv$BUGSoutput$sims.matrix)[,parameters]

tps <- function(var){
  ggplot(tp_vars, aes_(y=as.name(var), x=seq(1,nrow(tp_vars)))) +
    geom_line() +
    labs(x ="Iterations", y = as.name(var))
}

all_beta_trace = lapply(names(tp_vars), tps)
do.call(grid.arrange, all_beta_trace)
```

## Traceplots for Senate Model

```{r, echo = F}
states = c("Alaska", "Arizona", "Colorado", "Georgia", "Georgia-Special", "Iowa", "Kansas", "Maine", "Michigan", "Montana", "North Carolina", "South Carolina", "Texas")
N_states = states %>% length
betas_day_of_election = sapply(1:N_states, function(i) {paste0("beta.", i, ".1.")} )
parameters = c(betas_day_of_election)

tp_vars = data.frame(jags_sims$BUGSoutput$sims.matrix)[,parameters]

tps <- function(var){
  ggplot(tp_vars, aes_(y=as.name(var), x=seq(1,nrow(tp_vars)))) +
    geom_line() +
    labs(x ="Iterations", y = as.name(var))
}

all_beta_trace = lapply(names(tp_vars), tps)
do.call(grid.arrange, all_beta_trace)
```

## Traceplots for House Model

```{r, echo = F}
# CHANGE TO BE HOUSE SPECIFIC, IT WOULD BE DISTRCITS
betas_day_of_election = sapply(1:13, function(i) {paste0("beta.", i, ".1.")} )
parameters = c(betas_day_of_election)

tp_vars = data.frame(jags_sims_house$BUGSoutput$sims.matrix)[,parameters]

tps <- function(var){
  ggplot(tp_vars, aes_(y=as.name(var), x=seq(1,nrow(tp_vars)))) +
    geom_line() +
    labs(x ="Iterations", y = as.name(var))
}

all_beta_trace = lapply(names(tp_vars), tps)
do.call(grid.arrange, all_beta_trace)
```


## Residual Plot for Senate Model

```{r resid for senate, echo = F, fig.width = 8, fig.height = 4, fig.cap = "\\label{senateresid} Senate Model Residual Plot", message = F, warning = F}
require(reshape2)
Result_MCMC <- as.mcmc(jags_sims)
Result_data <- data.frame(as.matrix(Result_MCMC))
ResidualName <- seq(1, N_states)
for( idx in 1:N_states) {
  ResidualName[idx] <- capture.output(cat( c("res", idx, 2, ""), sep = "."))
}
residul_check <- Result_data[, ResidualName]
resid_df = melt(residul_check) %>%
  mutate(state = rep(c("AK", "AZ", "CO", "GA", "GA-Special", "IA", "KS", "ME", "MI", "MT", "NC", "SC", "TX"), rep(3000,13)))

ggplot(data = resid_df, aes(x=state, y=value, group = state)) + #scale_x_discrete(breaks = seq(1,13)) + 
  geom_boxplot(aes(fill=variable), outlier.size = 0.1) + theme(legend.position = "none") + labs(y = "Residuals", x = "Observation", title = "Boxplot of Senate Model Residuals the Day Before the Election") + theme(legend.position = "none") + labs(x = "States", y= "Residuals")
```

## Residual Plot for House Model

```{r resid for house, fig.width = 8, fig.height =4, echo = F, fig.cap = "\\label{houseresid} House Model Residual Plot", message = F, warning = F}
require(reshape2)
Result_MCMC <- as.mcmc(jags_sims_house)
Result_data <- data.frame(as.matrix(Result_MCMC))
ResidualName <- seq(1, N_states)
for( idx in 1:N_states) {
  ResidualName[idx] <- capture.output(cat( c("res", idx, 2, ""), sep = "."))
}
residul_check <- Result_data[, ResidualName]
resid_df = melt(residul_check) %>%
  mutate(state = rep(seq(1:13), rep(3000,13))) %>%
  mutate(state = factor(state))#, levels = c(1,2,3,4,5,6,7,8,9,10,11,12,13))

# resid_df$state = relevel(as.factor(resid_df$state), levels = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13"), ref = "1")

ggplot(data = resid_df, aes(x=state, y=value, group = state)) + #scale_x_discrete() + 
  geom_boxplot(aes(fill=variable), outlier.size = 0.1) + theme(legend.position = "none") + labs(y = "Residuals", x = "Observation", title = "Boxplot of House Model Residuals the Day Before the Election") + theme(legend.position = "none") + labs(x = "District", y= "Residuals")
```

\pagebreak

## References
1. Linzer, D. A. (2013). Dynamic Bayesian Forecasting of Presidential Elections in the States. Journal of the American Statistical Association, 108(501), 124-134. doi:10.1080/01621459.2012.737735
\newline
2. Hansford, T. G., &amp; Gomez, B. T. (2010). Estimating the Electoral Effects of Voter Turnout. American Political Science Review, 104(2), 268-288. doi:10.1017/s0003055410000109
\newline
3. 2020 Election. (2020, October 20). Retrieved October 20, 2020, from https://fivethirtyeight.com/politics/elections/
\newline
4. Park, D. K., Gelman, A., &amp; Bafumi, J. (2006). State-Level Opinions from National Surveys:. Public Opinion in State Politics, 209-228. doi:10.2307/j.ctvr33bdg.17
\newline
5. Mahler, V. A., Jesuit, D. K., &amp; Paradowski, P. R. (2013). Electoral Turnout and State Redistribution. Political Research Quarterly, 67(2), 361-373. doi:10.1177/1065912913509306
\newline
6. Uhlaner, C. J., &amp; Scola, B. (2015). Collective Representation as a Mobilizer. State Politics &amp; Policy Quarterly, 16(2), 227-263. doi:10.1177/1532440015603576
\newline
7. Godbout, J. (2012). Turnout and presidential coattails in congressional elections. Public Choice, 157(1-2), 333-356. doi:10.1007/s11127-012-9947-7
\newline
8. Kim, S. S., Alvarez, R. M., &amp; Ramirez, C. M. (2020). Who Voted in 2016? Using Fuzzy Forests to Understand Voter Turnout. doi:10.33774/apsa-2020-xzx29
\newline
9. Weinschenk, A. C. (2019) That’s Why the Lady Lost to the Trump: Demographics and the 2016 Presidential Election, Journal of Political Marketing, 18:1-2, 69-91, DOI: 10.1080/15377857.2018.1478657
\newline
10. Charles, K. K., &amp; Stephens, M. (2011). Employment, Wages and Voter Turnout. doi:10.3386/w17270
\newline
11. Hills, M. (2020, September 25). US election 2020: A really simple guide. Retrieved October 20, 2020, from https://www.bbc.com/news/election-us-2020-53785985
\newline
12. Railey, K. (2016). Federal Judges Let Stand North Carolina,'s New Congressional Map. The Hotline. https://link.gale.com/apps/doc/A498010836/ITOF?u=duke_perkins&sid=ITOF&xid=119d6ad9
\newline
13. Perrin, A. J., &amp; Ifatunji, M. A. (2020). Race, Immigration, and Support for Donald Trump: Evidence From the 2018 North Carolina Election. Sociological Forum, 35(S1), 941-953. doi:10.1111/socf.12600
\newline
14. Redistricting in North Carolina. (2020). Retrieved October 21, 2020, from https://ballotpedia.org/Redistricting_in_North_Carolina
\newline
15. Â§ 132-1. Public Records.
https://www.ncleg.gov/EnactedLegislation/Statutes/PDF/BySection/Chapter_132/GS_132-1.pdf
\newline
16. Â§ 163-82.10.  Official record of voter registration.
https://www.ncleg.gov/EnactedLegislation/Statutes/PDF/BySection/Chapter_163/GS_163-82.10.pdf
\newline
17. FairVote.org. (n.d.). Voter Turnout. Retrieved October 22, 2020, from https://www.fairvote.org/voter_turnout
\newline
18. McDonald, M. P. (2020). Voter Turnout Demographics. Retrieved October 23, 2020, from http://www.electproject.org/home/voter-turnout/demographics
\newline
19. Y. Ghitza, A. Gelman’s (2013). Deep interactions with MRP: Election Turnout and Voting Patterns Among Small Electoral Subgroups. American Journal of Political Science 57 762– 776.
\newline
20. Walker, H.L., Herron, M.C. & Smith, D.A. Early Voting Changes and Voter Turnout: North Carolina in the 2016 General Election. Polit Behav 41, 841–869 (2019). https://doi-org.proxy.lib.duke.edu/10.1007/s11109-018-9473-5 
\newline
21. Pew Research Center (2020). Men and women in the U.S. continue to differ in voter turnout rate, party identification. https://www.pewresearch.org/fact-tank/2020/08/18/men-and-women-in-the-u-s-continue-to-differ-in-voter-turnout-rate-party-identification/ 
\newline
22. Pew Research Center (2016). Party affiliation among voters: 1992-2016.
https://www.pewresearch.org/politics/2016/09/13/2-party-affiliation-among-voters-1992-2016/ 
\newline
23. J. Misra (2019). Voter Turnout Rates Among All Voting Age and Major Racial and Ethnic Groups Were Higher Than in 2014. https://www.pewresearch.org/fact-tank/2020/08/18/men-and-women-in-the-u-s-continue-to-differ-in-voter-turnout-rate-party-identification/
\newline
24. Killian, L. (2012). Five Myths About Independent Voters. Retrieved October 22, 2020, from https://www.washingtonpost.com/opinions/five-myths-about-independent-voters/2012/05/17/gIQAZmGyWU_story.html
\newline
25. Igielnik, R. (2020). Men and Women in the U.S. Continue to Differ in Voter Turnout Rate. Retrieved October 22, 2020, from https://www.pewresearch.org/fact-tank/2020/08/18/men-and-women-in-the-u-s-continue-to-differ-in-voter-turnout-rate-party-identification/
\newline
26. Akee, R. (2019). Voting and Income. Retrieved October 22, 2020, from https://econofact.org/voting-and-income
\newline
27. Wikipedia. 2020 United States elections. (2020, October 27). Retrieved October 31, 2020, from https://en.wikipedia.org/wiki/2020_United_States_elections
\newline
28. Gelman, A., &amp; Heidemanns, M. (2020). President-Forecasting the US 2020 elections. Retrieved November 01, 2020, from https://projects.economist.com/us-2020-forecast/president
\newline
29. Gelman, A., Hullman, J., Wlezien, C., & George, E. M. (2020). Information, incentives, and goals in election forecasts. Judgment and Decision Making, 15(5), 863-880. 
\newline
30. Gelman, A. and Heidemanns, M. (2020). President--Forecasting the US 2020 Elections | The Economist. Retrieved October 31, 2020 from https://projects.economist.com/us-2020-forecast/president
\newline
31. The Cook Political Report (2020). 2020 Electoral College Ratings. Retrieved October 31, 2020 from https://cookpolitical.com/sites/default/files/2020-10/EC%20Ratings.102820.pdf
\newline
32. The Cook Political Report (2020). 2020 Senate Race Ratings. Retrieved October 31, 2020 from https://cookpolitical.com/ratings/senate-race-ratings
\newline
33. Ballotpedia (2020). United States Senate special election in Georgia, 2020. Retrieved October 31, 2020 from https://ballotpedia.org/United_States_Senate_special_election_in_Georgia,_2020
\newline
34. FiveThirtyEight (2020). FiveThirtyEight's Partisan Lean. Retrieved October 31, 2020 from https://github.com/fivethirtyeight/data/tree/master/partisan-lean
\newline
35. Rakich, N. (2018). How Much Was Incumbency Worth In 2018? Retrieved October 31, 2020 from https://fivethirtyeight.com/features/how-much-was-incumbency-worth-in-2018/
\newline
36. Gillespie, A. et al. (2020). Race for the Senate 2020: Experts’ views from the states. Retrieved October 31, 2020 from https://www.brookings.edu/blog/fixgov/2020/10/30/race-for-the-senate-2020-experts-views-from-the-states/
\newline
37. Delsiver, D. (2020). Most Senate Elections Reflect States’ Presidential Votes. Retrieved October 31, 2020 from https://www.pewresearch.org/fact-tank/2020/09/01/most-senate-elections-reflect-states-presidential-votes/
\newline
38. Silver, N. (2014) Registered Voter Polls Will (Usually) Overrate Democrats.
Retrieved October 31, 2020 from https://fivethirtyeight.com/features/registered-voter-polls-will-usually-overrate-democrats/
\newline
39. The Economist. (2016). Hillary Clinton has got this. Probably. Very probably https://www.economist.com/graphic-detail/2016/11/08/hillary-clinton-has-got-this-probably-very-probably
\newline
40. Shirani-Mehr, H., Rothschild, D., Goel, S., &amp; Gelman, A. (2018). Disentangling Bias and Variance in Election Polls. Journal of the American Statistical Association, 113(522), 607-614. doi:10.1080/01621459.2018.1448823
\newline
41. McDonald, M. (2020). 2020 General Election Early Vote Statistics. Retrieved November 01, 2020, from https://electproject.github.io/Early-Vote-2020G/index.html
42. Morley, M. (1905). Election Emergencies: Voting in the Wake of Natural Disasters and Terrorist Attacks, 67 Emory L. J. 545. Available at: https://scholarlycommons.law.emory.edu/elj/vol67/iss3/6
\newline
43. Abramawitz, A. (2008). Forecasting the 2008Presidential Election with theTime-for-Change Model. Political Science and Politics Vol. 41, No. 4 (Oct., 2008), pp. 691-695. https://www.jstor.org/stable/20452296?seq=1#metadata_info_tab_contents
\newline
44. Golshan, T. (2016). Survey: Trump Won Big Among Voters Who Decided in the Last 2 Weeks of the Campaign. Retrieved November 1, 2020 from https://www.vox.com/policy-and-politics/2016/12/21/14025198/trump-undecided-final-weeks-survey
\newline
45. Silver, N. (2008). Allocating the Undecideds. Retrieved November 1, 2020 from https://fivethirtyeight.com/features/allocating-undecideds/
\newline
46. Silver, N. (2014). How The FiveThirtyEight Senate Forecast Model Works. Retrieved November 1, 2020 from https://fivethirtyeight.com/features/how-the-fivethirtyeight-senate-forecast-model-works/
\newline
47. Nilsen, E. (2020). Georgia’s two super-competitive Senate races, explained. Retrieved October 31, 2020 from https://www.vox.com/21536826/georgia-senate-race-ossoff-loeffler-warnock-perdue
\newline
48. Skelley, G. (2020). What Pollsters Have Changed Since 2016 — And What Still Worries Them About 2020. Retrieved November 1, 2020 from https://fivethirtyeight.com/features/what-pollsters-have-changed-since-2016-and-what-still-worries-them-about-2020/
\newline
49. Cohn, N. (2020). Are the Polls Missing Republican Voters? Retrieved November 1, 2020 from https://www.nytimes.com/2020/07/29/upshot/polls-political-party-republicans.html
\newline
50. U.S. Bureau of Economic Analysis. (2020). https://www.bea.gov/news/glance
